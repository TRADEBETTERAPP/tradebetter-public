name: Auto-comment on new issues

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Post welcome comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const title = issue.title || '';
            let body = '';

            if (title.startsWith('[Bug]')) {
              body = `Thanks for reporting this bug! üîç

            The team will triage this issue shortly. In the meantime:

            - Make sure you've included all the requested information in the template fields.
            - Check the [Support & FAQ](https://github.com/TRADEBETTERAPP/tradebetter-public/blob/main/.github/SUPPORT.md) for common error patterns and fixes.
            - If you find additional details or a workaround, please update this issue.

            We'll apply a label once the issue has been reviewed.`;
            } else if (title.startsWith('[Feature]')) {
              body = `Thanks for the feature request! üí°

            The team will review this proposal and assess its priority. Here's what to expect:

            - We'll evaluate the problem statement, proposed solution, and impact.
            - Accepted requests will be labelled \`accepted\` and scheduled for implementation.
            - You'll be notified when work begins and when the feature ships.

            In the meantime, check [existing feature requests](https://github.com/TRADEBETTERAPP/tradebetter-public/issues?q=is%3Aissue+label%3Afeature) to see if similar ideas have been proposed.`;
            } else if (title.startsWith('[Help]')) {
              body = `Thanks for reaching out! üôã

            The team will get back to you shortly. While you wait:

            - Review the [Support & FAQ](https://github.com/TRADEBETTERAPP/tradebetter-public/blob/main/.github/SUPPORT.md) ‚Äî your answer may already be there.
            - Check the [common error patterns table](https://github.com/TRADEBETTERAPP/tradebetter-public/blob/main/.github/SUPPORT.md#common-error-patterns) for quick fixes.
            - Browse [existing help threads](https://github.com/TRADEBETTERAPP/tradebetter-public/issues?q=is%3Aissue+label%3Atriage) for similar questions.`;
            } else {
              body = `Thanks for opening this issue! üìù

            The team will review it shortly. Please make sure you've provided enough detail for us to act on it.

            - [Support & FAQ](https://github.com/TRADEBETTERAPP/tradebetter-public/blob/main/.github/SUPPORT.md)
            - [Issue Guide](https://github.com/TRADEBETTERAPP/tradebetter-public/blob/main/.github/ISSUE_GUIDE.md)
            - [Contributing Guidelines](https://github.com/TRADEBETTERAPP/tradebetter-public/blob/main/CONTRIBUTING.md)`;
            }

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: body,
            });
